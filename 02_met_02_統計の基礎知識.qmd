---
title: "2.統計の基礎知識"
date: "2024-10-01"
execute: 
  error: true
  cache: true
format:
  html: 
    slide-level: 2
    toc: true
---

# 目的
母集団と標本（サンプル）の考え方を学ぶ。

# 母集団と標本
例えば、政党の支持率に関するアンケート調査を行うことを想定する。  

全有権者に対してアンケートを行うことは効率的でないため、少数の有権者をランダムに選び、調査を行う。  

ここで、母集団とは、有権者全体を指し、選ばれた一部のアンケート回答者を標本（サンプル）という。

### 正規分布と標準偏差
母集団として用いられる確率分布には、正規分布（normal distribution）がある。  

正規分布では、山の中心を平均、横幅を標準偏差という。  

そして、平均や標準偏差のような母集団分布の形状を決める係数をパラメータや母数という。  

例えば、統計的な表現では、平均が50、標準偏差が10の正規分布をN（50, 10^2）と表現する。 
ここで、10^2は標準偏差の２乗である分散を指す。  

- rnorm(): 指定された平均と標準偏差に基づいて正規分布からランダムな値を生成する関数  
平均50、標準偏差10の正規分布に従う乱数を20個作る。
```{r}
rnorm(20, 50, 10)
```
- dnorm(): 正規分布の密度（density）を調べる関数
- curve(): 与えられた関数を、最小値から最大値までの範囲でグラフ化する関数
```{r}
curve(dnorm(x, 50, 10), 0, 100)
```
- pnorm(): 正規分布の累積分布関数 (CDF) を計算する関数  
平均が50、標準偏差が10の正規分布において、値 60 以下の確率を返します。
```{r}
pnorm(60, 50, 10)
```

### ヒストグラム作成
```{r}
z <- rnorm(100, 50, 10)
hist(z)
```

ggplot2でヒストグラムを作成する場合
```{r}
library(tidyverse)

z2 <- tibble(value = rnorm(100, 50, 10)) # 列名をvalueとしてデータフレームに格納する

ggplot(
    data = z2,
    mapping = aes(x = value,
    color = "red",
    fill = "red")) +
  geom_histogram(binwidth = 15, alpha = 0.5)
```

```{r}
# 最大値を調べる
which.max(z)

# 平均値を調べる
mean(z)

# 基本統計量をまとめて計算する
summary(z)
```
sample(): 決められた数の標本をランダムに抽出する関数
```{r}
# 1から10までの自然数
1:10

# ランダムに３つ取り出す
sample(1:10, 3)

# 標本zから５個の数字をランダムで取り出す
sample(z, 5)

# 要素が２つしかないものの中から、５つ取り出そうとするためエラーが発生
coin <- c("head", "tail")
sample(coin, 5)

# replece = TRUEで復元抽出を行う
sample(coin, 5, replace = TRUE)
```

### 平均と大数の法則

母集団（平均50、標準偏差10）から100の標本を作る作業を1000回繰り返して結果を表示します。
```{r}
S <- 1000
rec <- numeric(S)
for(i in 1:S){
  rec[i] <- mean(rnorm(100, 50, 10))
}

summary(rec)
```

標本の大きさを100から10000に増やすと、標本平均は母平均に近づきます。  

これが、大数の法則です。
```{r}
S <- 1000
rec <- numeric(S)
for(i in 1:S){
  rec[i] <- mean(rnorm(10000, 50, 10))
}

summary(rec)
```

サイコロでの検証
```{r}
# サイコロの期待値
sai <- c(1:6) * 1/6
sum(sai)

# サイコロを10回振る
sample(1:6, 10, replace = TRUE)

# サイコロを1000回振る
mean(sample(1:6, 1000, replace = TRUE))
```
もう少し詳しく調べる場合
```{r}
# サイコロを10回振る
S <- 1000
rec <- numeric(S)
for(i in 1:S){
  rec[i] = mean(sample(1:6, 10, replace = TRUE))
}

summary(rec)

# サイコロを1000回振る
S <- 1000
rec <- numeric(S)
for(i in 1:S){
  rec[i] = mean(sample(1:6, 1000, replace = TRUE))
}

summary(rec)
```

### 分散と標準偏差
分散は、標本が平均値を中心にどれだけ散らばっているかを示す指標です。  

また、標準偏差は、分散の平方根をとったものです。
```{r}
x <- rnorm(1000, 50, 10)

# 分散
var(x)

# 標準偏差
sd(x)
```
標準偏差は最小値から最大値の範囲に収まっており、母集団の標準偏差10の周りに集まっていることがわかる。
```{r}
# 検証
set.seed(123)
S <- 1000
n <- 1000
rec <- numeric(S)
for(i in 1:S){
  rec[i] <- sd(rnorm(n, 50, 10))
}

summary(rec)
```

### 相関係数と共分散

相関係数は、変数間の関係を表す指標で－1から１の範囲の値をとります。  

共分散は、2つの変数の間の関係の強さと方向を示す指標です。  

共分散が正の場合、片方の変数が増加するともう片方も増加する傾向があります。  
逆に、共分散が負の場合、片方の変数が増加するともう片方は減少する傾向があります。
```{r}
x = rnorm(100, 50, 10)
y = rnorm(100, 50, 10)
plot(x, y)
# 相関係数を確認
cor(x, y)
# 共分散を確認
cov(x, y)

z = (x + y) / 2
plot(x, z)
# 相関係数を確認
cor(x, z)
# 共分散を確認
cov(x, z)
```

# 練習問題
### 一様分布からのサンプリング

- runif(): 指定した範囲の一様分布から乱数を生成する関数
```{r}
# runif(n, min = 0, max = 1)
x <- runif(100)
mean(x)
var(x)
sd(x)
summary(x)
```

1000の標本を抽出する場合の標本平均を確認します。
```{r}
S <- 1000
n <- 1000
rec <- numeric(S)

for(i in 1:S){
    rec[i] <- mean(runif(n))
}

summary(x)
```

### 標本x, y, zを作成
```{r}
n <- 100
x <- runif(n)
y <- rnorm(n, 0, 1)
z <- 1.3 * x - 0.7 * y
```
散布図を表示して確認します。
- par(): プロットの設定を変更する関数。mfrow引数でパネルを１行３列に分割
```{r}
# 1行3列に分割
par(mfrow = c(1, 3))
plot(x, y)
plot(y, z)
plot(x, z)
# 1行1列に戻す
par(mfrow = c(1, 1)) 
```
相関係数を確認します。
- cbind(): 複数のベクトルをまとめる関数
- data.frame(): データフレームに変換する関数
```{r}
w <- cbind(x, y, z)
cor(w)
plot(data.frame(x, y, z))
```